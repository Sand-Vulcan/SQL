--In this project, I'lll explore the top 400 best-selling video games created between 1977 and 2020. 
--I'll compare a dataset on game sales with critic and user reviews to determine whether or not video games have improved as the gaming market has grown.
--The database contains two tables, game_sales and reviews; and I've limited each table to 400 rows for this project.
--The complete dataset with over 13,000 games can be found on Kaggle.

--Let's begin by looking at the top 10 best-selling games of all time

SELECT *
FROM game_sales
ORDER BY games_sold DESC
LIMIT 10;

--The best-selling video games were released between 1985 to 2017! That's quite a range so I'll have to use data from the reviews table to gain more insight on the best years for video games.
--One shortcoming of the database is that there is not any reviews data for some of the games on the game_sales table.

-- Join games_sales and reviews
-- Count the number of games where both critic_score and user_score are null

SELECT COUNT(g.game)
FROM game_sales AS g
LEFT JOIN reviews AS r
ON g.game = r.game
WHERE critic_score IS NULL AND user_score IS NULL;

--There are many ways to measure the best years for video games! Let's start with what the critics think.

-- Select release year and average critic score for each year, rounded and aliased
-- Join the game_sales and reviews tables
-- Group by release year
-- Order the data from highest to lowest avg_critic_score and limit to 10 results

SELECT g.year, AVG(r.critic_score) AS avg_critic_score
FROM game_sales AS g
INNER JOIN reviews AS r
ON g.game = r.game
GROUP BY g.year
ORDER BY avg_critic_score DESC
LIMIT 10;

--The range of great years according to critic reviews goes from 1982 until 2020.
--Some of those avg_critic_score values look like suspiciously round numbers for averages. 
--The value for 1982 looks especially fishy (9.00000).
--Maybe there weren't a lot of video games in our dataset that were released in certain years.
--Let's update our query and find out whether 1982 really was such a great year for video games.

-- Update the query so that it only returns years that have more than four reviewed games

SELECT g.year, COUNT(g.game) AS num_games, AVG(r.critic_score) AS avg_critic_score
FROM game_sales AS g
INNER JOIN reviews AS r
ON g.game = r.game
GROUP BY g.year
HAVING COUNT(g.game) >4
ORDER BY avg_critic_score DESC
LIMIT 10;

--The new num_games column convinces us that our new list of the critics' top games reflects years that had quite a few well-reviewed games rather than just one or two hits. 
--But let's identify which years dropped off the list due to having four or fewer reviewed games and determine whether they might rightfully be considered as excellent years for video game releases.
--I'll create tables with the results of our previous two queries: top_critic_years and top_critic_years_more_than_four_games.

--Select the year and avg_critic_score for those years that dropped off the critics' favorites list
-- Order the results from highest to lowest avg_critic_score

SELECT year, avg_critic_score
FROM top_critic_years
EXCEPT
SELECT year, avg_critic_score
FROM top_critic_years_more_than_four_games
ORDER BY avg_critic_score DESC;

--Based on the task above, it looks like the early 1990s might merit consideration as the golden age of video games based on critic_score alone.
--Let's move on to looking at the opinions of playersp 
--To begin, I'll create a query very similar to the one used in Task Four, except this one will look at user_score averages by year rather than critic_score averages.

-- Select year, an average of user_score, and a count of games released in a given year, aliased and rounded
-- Include only years with more than four reviewed games; group data by year
-- Order data by avg_user_score, and limit to ten results

SELECT g.year, COUNT(g.game) AS num_games, 
AVG(r.user_score) AS avg_user_score
FROM game_sales AS g
INNER JOIN reviews AS r
ON g.game = r.game
GROUP BY g.year
HAVING COUNT(g.game) >4
ORDER BY avg_user_score DESC
LIMIT 10;

--Now I've got a list of the top ten years according to both critic reviews and user reviews. 
--If there are any years that showed up on both tables, they would certainly be excellent ones!
--I'll use the information from the top_critic_years_more_than_four_games table, as well as creating a new table called top_user_years_more_than_four_games.

-- Select the year results that appear on both tables

SELECT year
FROM top_user_years_more_than_four_games
INTERSECT
SELECT year
FROM top_critic_years_more_than_four_games;

--Looks like we've got three years that both users and critics agreed were in the top ten (1998, 2002, 2008).
--We know that critics and players liked these years, but what about video game makers? Were sales good? Let's find out.

--Select year and sum of games_sold, aliased as total_games_sold; order results by total_games_sold descending
-- Filter game_sales based on whether each year is in the list returned in the previous task

SELECT g.year, SUM(g.games_sold) AS total_games_sold
FROM game_sales g
WHERE g.year IN (SELECT year
FROM top_user_years_more_than_four_games
INTERSECT
SELECT year
FROM top_critic_years_more_than_four_games)
GROUP BY g.year
ORDER BY total_games_sold DESC;
